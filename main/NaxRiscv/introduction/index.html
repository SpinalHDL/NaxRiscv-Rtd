

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Introduction &mdash; NaxRiscv  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/logo3_32x32.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/2.6.8/skins/default.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/wavedrom/2.6.8/wavedrom.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Frontend" href="../frontend/index.html" />
    <link rel="prev" title="&lt;no title&gt;" href="../../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NaxRiscv
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#naxriscv">NaxRiscv</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#project-developpement-and-status">Project developpement and status</a></li>
<li class="toctree-l3"><a class="reference internal" href="#why-a-ooo-core-targeting-fpga">Why a OoO core targeting FPGA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline">Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-use">How to use</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardware-description">Hardware description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../frontend/index.html">Frontend</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../frontend/index.html#decoder">Decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/index.html#physical-register-allocation">Physical register allocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/index.html#architectural-to-physical">Architectural to physical</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/index.html#physical-to-rob-id">Physical to ROB ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/index.html#dispatch-issue">Dispatch / Issue</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../execution_units/index.html">Execution units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../memory/index.html">Memory system</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../memory/index.html#load-store-unite">Load store unite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../memory/index.html#mmu">MMU</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../branch_prediction/index.html">Branch prediction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../branch_prediction/index.html#fetch-prediction">Fetch prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../branch_prediction/index.html#decode-prediction">Decode prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../branch_prediction/index.html#jump-branch-circular-buffer">Jump/branch circular buffer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../backend/index.html">Backend</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../backend/index.html#commit">Commit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backend/index.html#register-file">Register file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simulation/index.html">Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulation/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/index.html#spike">Spike</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../performance/index.html">Performance and Area</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.html#rv32">RV32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.html#rv64">RV64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.html#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../abstraction/index.html">Abstractions / HDL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../abstraction/index.html#framework">Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#plugin-tasks">Plugin tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#service-definition">Service definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#service-implementation">Service implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#service-usage">Service usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#service-pipeline-definition">Service Pipeline definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#service-pipeline-usage">Service Pipeline usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#execution-units">Execution units</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstraction/index.html#shiftplugin">ShiftPlugin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../abstraction/index.html#pipeline">Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abstraction/index.html#state-machine-api">State machine API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abstraction/index.html#automated-multiport-memory-transformation">Automated multiport memory transformation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Misc</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc/index.html#jtag-openocd-gdb">Jtag / OpenOCD / GDB</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NaxRiscv</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/NaxRiscv/introduction/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="naxriscv">
<h2>NaxRiscv<a class="headerlink" href="#naxriscv" title="Permalink to this headline">¶</a></h2>
<p>NaxRiscv is a core currently characterised by :</p>
<ul class="simple">
<li><p>Out of order execution with register renaming</p></li>
<li><p>Superscalar (ex : 2 decode, 3 execution units, 2 retire)</p></li>
<li><p>(RV32 RV64)IMASU (Linux / Buildroot works on harwdare)</p></li>
<li><p>Portable HDL, but target FPGA with distributed ram (Xilinx series 7 is the reference used so far)</p></li>
<li><p>Target a (relatively) low area usage and high fmax (not the best IPC)</p></li>
<li><p>Decentralized hardware elaboration (Empty toplevel parametrized with plugins)</p></li>
<li><p>Frontend implemented around a pipelining framework to ease customisation</p></li>
<li><p>Non-blocking Data cache with multiple refill and writeback slots</p></li>
<li><p>BTB + GSHARE + RAS branch predictors</p></li>
<li><p>Hardware refilled MMU (SV32, SV39)</p></li>
<li><p>Load to use latency of 3 cycles via the speculative cache hit predictor</p></li>
<li><p>Pipeline visualisation via verilator simulation and Konata (gem5 file format)</p></li>
<li><p>JTAG / OpenOCD / GDB support by implementing the RISCV External Debug Support v. 0.13.2</p></li>
</ul>
<div class="section" id="project-developpement-and-status">
<h3>Project developpement and status<a class="headerlink" href="#project-developpement-and-status" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>This project is free and open source</p></li>
<li><p>It can run upstream buildroot/linux on hardware (ArtyA7-35T / Litex)</p></li>
<li><p>It started in October 2021, got some funding from NLnet later on.</p></li>
<li><p>Unfortunately the project started with a single crew (not by wish), contribution are welcome.</p></li>
</ul>
</div>
<div class="section" id="why-a-ooo-core-targeting-fpga">
<h3>Why a OoO core targeting FPGA<a class="headerlink" href="#why-a-ooo-core-targeting-fpga" title="Permalink to this headline">¶</a></h3>
<p>There is a few reasons</p>
<ul class="simple">
<li><p>Improving single threaded performance.
During the tests made with VexRiscv running linux, it was clear that even if the can multi core help, “most” applications aren’t made to take advantage of it.</p></li>
<li><p>Hiding the memory latency (There isn’t much memory to have a big L2 cache on FPGA)</p></li>
<li><p>To experiment with more advanced hardware description paradigms (scala / SpinalHDL)</p></li>
<li><p>By personnal interest</p></li>
</ul>
<p>Also there wasn’t many OoO opensource softcore out there in the wild (Marocchino, RSD, OPA, ..).
The bet was that it was possible to do better in some metrics, and hopfully being good enough to justify in some project
the replacement of single issue / in order core softcore by providing better performances (at the cost of area).</p>
</div>
</div>
<div class="section" id="pipeline">
<h2>Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this headline">¶</a></h2>
<p>NaxRiscv is composed of multiple pipelines :</p>
<ul class="simple">
<li><p><strong>Fetch</strong> : Which provide the raw data for a given PC, provide a first level of branch prediction and do the PC memory translation</p></li>
<li><p><strong>Frontend</strong> : Which align, decode the fetch raw data, provide a second level of branch prediction, then allocates and rename the ressources required for the instruction</p></li>
<li><p><strong>Execution units</strong> : Which get the ressources required for a given instruction (ex RF, PC, ..), execute it, write its result back and notify completion.</p></li>
<li><p><strong>LSU load</strong> : Which read the data cache, translate the memory address, check for older store depedencies and eventualy bypass a store value.</p></li>
<li><p><strong>LSU store</strong> : Which translate the memory address and check for younger load having notified completion while having a depedency with the given store</p></li>
<li><p><strong>LSU writeback</strong> : Which will write commited store into the data cache</p></li>
</ul>
<p>But it should also be noticed that there is a few state machines :</p>
<ul class="simple">
<li><p><strong>LSU Atomic</strong> : Which sequencialy execute SC/AMO operations once they are the next in line for commit.</p></li>
<li><p><strong>MMU refill</strong> : Which walk the page tables to refill the TLB</p></li>
<li><p><strong>Privileged</strong> : Which will check and update the CSR required for trap and privilege switches (mret, sret)</p></li>
</ul>
<p>Here is a general architectural diagram :</p>
<img alt="../../_images/pipeline_simple.png" src="../../_images/pipeline_simple.png" />
</div>
<div class="section" id="how-to-use">
<h2>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h2>
<p>There is currently two way you can try NaxRiscv :</p>
<ul class="simple">
<li><p><strong>Simulation</strong> : Via verilator (<a class="reference external" href="https://github.com/SpinalHDL/NaxRiscv/blob/main/src/test/cpp/naxriscv/README.md">https://github.com/SpinalHDL/NaxRiscv/blob/main/src/test/cpp/naxriscv/README.md</a>)</p></li>
<li><p><strong>Hardware</strong> : Via the Litex integration (<a class="reference external" href="https://github.com/SpinalHDL/NaxRiscv#running-on-hardware">https://github.com/SpinalHDL/NaxRiscv#running-on-hardware</a>)</p></li>
</ul>
</div>
<div class="section" id="hardware-description">
<h2>Hardware description<a class="headerlink" href="#hardware-description" title="Permalink to this headline">¶</a></h2>
<p>NaxRiscv was designed using SpinalHDL (A Scala hardware description library).
One goal of the implementation was to explore new hardware elaboration paradigmes as :</p>
<ul class="simple">
<li><p>Automatic pipelining framework</p></li>
<li><p>Distributed hardware elaboration</p></li>
<li><p>Software paradigmes applied to hardware elaboration (ex : software interface)</p></li>
</ul>
<p>A few notes about it :</p>
<ul class="simple">
<li><p>You can get generate the Verilog or the VHDL from it.</p></li>
<li><p>A whole chapter (<a class="reference internal" href="../abstraction/index.html#abstraction-hdl"><span class="std std-ref">Abstractions / HDL</span></a>) of the doc is dedicated to explore the different paradigmes used</p></li>
</ul>
</div>
</div>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../frontend/index.html" class="btn btn-neutral float-right" title="Frontend" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../../index.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Spaghetti god.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>